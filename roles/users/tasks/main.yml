---
- name: Create blueteam group
  group:
    name: blueteam
    state: present

- name: Create blueteam user
  user:
    name: blueteam
    state: present
    groups: "blueteam sudo wheel adm"
    append: yes
    shell: /bin/bash
  ignore_errors: true

#todo dont change passwords or white black grey users
- name: Read /etc/passwd and filter users with valid shells
  ansible.builtin.shell: "awk -F: '$7 ~ /^\\/bin\\// {print $1}' /etc/passwd"
  user_list: valid_users

#todo remove users that arent legit

- name: Generate and set passwords for each user
  user:
    name: "{{ item }}"
    password: "{{ lookup('ansible.builtin.password', term1, term2, key1=value1, key2=value2) }}"
  loop: "{{ user_list }}"
